# Redis Deployment for BPMSoft

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Redis —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è BPMSoft —Å–æ–≥–ª–∞—Å–Ω–æ –º–∞–Ω—É–∞–ª—É –≤–µ–Ω–¥–æ—Ä–∞.

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
redis/
‚îú‚îÄ‚îÄ playbook.yml              # –ì–ª–∞–≤–Ω—ã–π –ø–ª–µ–π–±—É–∫
‚îú‚îÄ‚îÄ inventory/hosts.yml       # –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å —Å–µ—Ä–≤–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ group_vars/all.yml        # –û–±—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ roles/
‚îÇ   ‚îú‚îÄ‚îÄ redis_install/        # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Redis
‚îÇ   ‚îî‚îÄ‚îÄ redis_configure/      # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ deploy-redis.sh           # –°–∫—Ä–∏–ø—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ README.md                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –∫–ª—é—á–µ–π (–ø–µ—Ä–≤—ã–π —Ä–∞–∑)
```bash
# –ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
./setup-ssh.sh --ask-pass
```

### 2. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Redis
```bash
cd redis
./deploy-redis.sh dev
```

### 3. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å –ø–∞—Ä–æ–ª–µ–º (–µ—Å–ª–∏ SSH –∫–ª—é—á–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã)
```bash
./deploy-redis.sh dev --ask-pass
```

## üìã –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –û–°

- **Debian/Ubuntu/Astra** - `redis-server` —Å–µ—Ä–≤–∏—Å
- **RHEL/CentOS/RED OS** - `redis` —Å–µ—Ä–≤–∏—Å  
- **ALT Linux** - `redis` —Å–µ—Ä–≤–∏—Å

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (group_vars/all.yml)
```yaml
redis_port: 6379
redis_bind_address: "0.0.0.0"
redis_protected_mode: false
redis_requirepass: "BPMSoftRedis2024!"
redis_maxmemory: "256mb"
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ –º–∞–Ω—É–∞–ª—É –≤–µ–Ω–¥–æ—Ä–∞
- `supervised systemd` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ systemd
- `#bind 127.0.0.1` - –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –±–∏–Ω–¥–∞
- `protected-mode no` - –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞

## üéØ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å

### –¢–µ–∫—É—â–∏–µ —Ö–æ—Å—Ç—ã
- `crmcachedev-alventa` - 192.168.154.14 (–æ—Å–Ω–æ–≤–Ω–æ–π Redis –∫—ç—à)
- `redis-test-nau` - 10.10.0.47 (—Ç–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä)

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ö–æ—Å—Ç–∞
```yaml
# –í inventory/hosts.yml
new-redis-host:
  ansible_host: 192.168.1.100
  ansible_user: admin
  ansible_ssh_private_key_file: ~/.ssh/id_rsa
  redis_config_dir: "/etc/redis"
  redis_data_dir: "/var/lib/redis"
  redis_log_dir: "/var/log/redis"
```

## üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```bash
redis-cli -h 192.168.154.14 -p 6379 -a "BPMSoftRedis2024!" ping
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–∞
```bash
ansible redis_servers -i inventory/hosts.yml -m systemd -a "name=redis-server state=started"
```

## üè∑Ô∏è –¢–µ–≥–∏

- `install` - —Ç–æ–ª—å–∫–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Redis
- `configure` - —Ç–æ–ª—å–∫–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `redis` - –≤—Å–µ –∑–∞–¥–∞—á–∏ Redis

### –ó–∞–ø—É—Å–∫ —Å —Ç–µ–≥–∞–º–∏
```bash
ansible-playbook -i inventory/hosts.yml playbook.yml --tags install
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- SSH –∫–ª—é—á–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä–∞–º
- –ü–∞—Ä–æ–ª—å –¥–ª—è Redis (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö)
- –û—Ç–∫–ª—é—á–µ–Ω protected-mode –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏
- –ù–∞—Å—Ç—Ä–æ–µ–Ω maxmemory –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è OOM

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ Redis
```bash
# Debian/Ubuntu
tail -f /var/log/redis/redis-server.log

# RHEL/RED OS
tail -f /var/log/redis.log
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Redis
```bash
redis-cli -h <host> -p 6379 -a <password> info
```

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### Redis –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
redis-server /etc/redis/redis.conf --test-memory 1

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
journalctl -u redis-server -f
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∏–Ω–¥–∏–Ω–≥
netstat -tlnp | grep 6379

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å firewall
iptables -L | grep 6379
```

## üìù Changelog

- **v1.0.0** - –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Debian/Ubuntu, RHEL/RED OS, ALT Linux
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–∞–Ω—É–∞–ª—É –≤–µ–Ω–¥–æ—Ä–∞ BPMSoft
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –û–° –∏ –ø—É—Ç–µ–π
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
